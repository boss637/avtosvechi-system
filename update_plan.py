#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è PLAN.md –ø–æ –ø—Ä–∞–≤–∫–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
"""

import re

def read_file(filename):
    """–ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª"""
    with open(filename, 'r', encoding='utf-8') as f:
        return f.read()

def write_file(filename, content):
    """–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª"""
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(content)

def update_plan_content(content):
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ PLAN.md"""
    
    # –ù–∞—Ö–æ–¥–∏–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É
    meta_pattern = r'(\*\*–í–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞:\*\*.+?\n\n)'
    meta_match = re.search(meta_pattern, content, re.DOTALL)
    
    if meta_match:
        print("‚úÖ –ù–∞–π–¥–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞")
        metadata = meta_match.group(1)
        
        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–∞
        content = content.replace(metadata, '', 1)
        
        # –ù–∞—Ö–æ–¥–∏–º –Ω–∞—á–∞–ª–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏ (–ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞)
        title_end = content.find('# üó∫Ô∏è –ü–ª–∞–Ω —Ä–∞–±–æ—Ç:')
        if title_end != -1:
            # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–µ—Ü –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞)
            header_end = content.find('\n\n', title_end)
            if header_end != -1:
                # –í—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                new_content = content[:header_end] + '\n\n' + metadata + content[header_end+2:]
                content = new_content
                print("‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É–Ω–∫—Ç 2 –≤ –°–û–î–ï–†–ñ–ê–ù–ò–ò
    # –ò—â–µ–º –°–û–î–ï–†–ñ–ê–ù–ò–ï
    content_section = re.search(r'## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï\n\n(.+?)\n\n---', content, re.DOTALL)
    if content_section:
        print("‚úÖ –ù–∞–π–¥–µ–Ω–æ –°–û–î–ï–†–ñ–ê–ù–ò–ï")
        old_content = content_section.group(1)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É–Ω–∫—Ç 2
        # –°—Ç–∞—Ä—ã–π: "2. –¢–ï–°–¢–´. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π"
        # –ù–æ–≤—ã–π: "2. [–¢–ï–°–¢–´ –∏ –¢–†–ò–ê–î–ê –ê–ì–ï–ù–¢–û–í. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞](./docs/TRINITY_AGENTS_PLAN.md)"
        
        new_point_2 = "2. [–¢–ï–°–¢–´ –∏ –¢–†–ò–ê–î–ê –ê–ì–ï–ù–¢–û–í. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞](./docs/TRINITY_AGENTS_PLAN.md)"
        
        # –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π –ø—É–Ω–∫—Ç 2 –Ω–∞ –Ω–æ–≤—ã–π
        lines = old_content.split('\n')
        for i, line in enumerate(lines):
            if line.strip().startswith('2.'):
                lines[i] = new_point_2
                print(f"‚úÖ –ü—É–Ω–∫—Ç 2 –æ–±–Ω–æ–≤–ª–µ–Ω: {new_point_2}")
                break
        
        new_content_section = '\n'.join(lines)
        content = content.replace(old_content, new_content_section)
    
    return content

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PLAN.md...")
    
    try:
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
        content = read_file('project/PLAN.md')
        print(f"‚úÖ –§–∞–π–ª –ø—Ä–æ—á–∏—Ç–∞–Ω, —Ä–∞–∑–º–µ—Ä: {len(content)} —Å–∏–º–≤–æ–ª–æ–≤")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        updated_content = update_plan_content(content)
        
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
        write_file('project/PLAN.md', updated_content)
        print("‚úÖ PLAN.md –æ–±–Ω–æ–≤–ª–µ–Ω")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        print("\n=== –ö–†–ê–¢–ö–ò–ô –û–ë–ó–û–† –ò–ó–ú–ï–ù–ï–ù–ò–ô ===")
        print("1. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å (–ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞)")
        print("2. –ü—É–Ω–∫—Ç 2 –°–û–î–ï–†–ñ–ê–ù–ò–Ø –æ–±–Ω–æ–≤–ª–µ–Ω:")
        print("   –ë—ã–ª–æ: '2. –¢–ï–°–¢–´. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π'")
        print("   –°—Ç–∞–ª–æ: '2. [–¢–ï–°–¢–´ –∏ –¢–†–ò–ê–î–ê –ê–ì–ï–ù–¢–û–í. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞](./docs/TRINITY_AGENTS_PLAN.md)'")
        print("3. –°—Å—ã–ª–∫–∞ –≤–µ–¥–µ—Ç –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç —Ç—Ä–∏–∞–¥—ã –≤ docs/")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return 1
    
    return 0

if __name__ == "__main__":
    exit(main())
